<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard • CV Parser Pro</title>

  <!-- Tailwind (via CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/static/styles.css">
  <style>
    /* Hide page content until authentication is verified */
    body.auth-checking {
      visibility: hidden;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans auth-checking">

  <!-- ==================== HEADER ==================== -->
  <header class="bg-white shadow-sm border-b fixed top-0 left-0 right-0 z-50">
    <div class="flex items-center justify-between px-6 py-3">
      <div class="flex items-center space-x-8">
        <h1 class="text-2xl font-bold text-blue-900">CV Parser Pro <span class="text-sm text-red-600">(Admin)</span></h1>
        <nav class="hidden md:flex space-x-6">
          <a href="#" class="tab-link text-blue-700 font-medium" data-tab="dashboard">Dashboard</a>
          <a href="#" class="tab-link text-gray-600 hover:text-blue-700" data-tab="upload-cv">Upload CV</a>
          <a href="#" class="tab-link text-gray-600 hover:text-blue-700" data-tab="upload-jd">Upload JD</a>
          <a href="#" class="tab-link text-gray-600 hover:text-blue-700" data-tab="search">Search CVs</a>
          <a href="#" class="tab-link text-gray-600 hover:text-blue-700" data-tab="users">Users</a>
          <a href="#" class="tab-link text-gray-600 hover:text-blue-700" data-tab="data-browser">Data Browser</a>
          <a href="#" class="tab-link text-gray-600 hover:text-blue-700" data-tab="bulk-ops">Bulk Ops</a>
          <a href="#" class="tab-link text-gray-600 hover:text-blue-700" data-tab="maintenance">Maintenance</a>
          <a href="#" class="tab-link text-gray-600 hover:text-blue-700" data-tab="logs">Logs</a>
        </nav>
      </div>
      <div class="flex items-center space-x-4">
        <div id="admin-info" class="text-sm text-gray-600 hidden"></div>
        <button id="logout-btn" class="text-red-600 hover:underline text-sm">Logout</button>
      </div>
    </div>
  </header>

  <!-- ==================== SIDEBAR ==================== -->
  <aside class="fixed left-0 top-16 bottom-0 w-64 bg-white shadow-md p-6 hidden lg:block overflow-y-auto">
    <ul class="space-y-2">
      <li><a href="#" class="tab-link flex items-center space-x-3 text-blue-700 font-medium px-3 py-2 rounded" data-tab="dashboard"><i class="fas fa-tachometer-alt w-5"></i><span>Dashboard</span></a></li>
      <li><a href="#" class="tab-link flex items-center space-x-3 text-gray-600 hover:text-blue-700 px-3 py-2 rounded" data-tab="upload-cv"><i class="fas fa-user-plus w-5"></i><span>Upload CV</span></a></li>
      <li><a href="#" class="tab-link flex items-center space-x-3 text-gray-600 hover:text-blue-700 px-3 py-2 rounded" data-tab="upload-jd"><i class="fas fa-file-alt w-5"></i><span>Upload JD</span></a></li>
      <li><a href="#" class="tab-link flex items-center space-x-3 text-gray-600 hover:text-blue-700 px-3 py-2 rounded" data-tab="search"><i class="fas fa-search w-5"></i><span>Search & Rank</span></a></li>
      <li class="border-t pt-2 mt-2"></li>
      <li><a href="#" class="tab-link flex items-center space-x-3 text-gray-600 hover:text-blue-700 px-3 py-2 rounded" data-tab="users"><i class="fas fa-users-cog w-5"></i><span>Users</span></a></li>
      <li><a href="#" class="tab-link flex items-center space-x-3 text-gray-600 hover:text-blue-700 px-3 py-2 rounded" data-tab="data-browser"><i class="fas fa-database w-5"></i><span>Data Browser</span></a></li>
      <li><a href="#" class="tab-link flex items-center space-x-3 text-gray-600 hover:text-blue-700 px-3 py-2 rounded" data-tab="bulk-ops"><i class="fas fa-trash-alt w-5"></i><span>Bulk Operations</span></a></li>
      <li><a href="#" class="tab-link flex items-center space-x-3 text-gray-600 hover:text-blue-700 px-3 py-2 rounded" data-tab="maintenance"><i class="fas fa-wrench w-5"></i><span>Maintenance</span></a></li>
      <li><a href="#" class="tab-link flex items-center space-x-3 text-gray-600 hover:text-blue-700 px-3 py-2 rounded" data-tab="logs"><i class="fas fa-clipboard-list w-5"></i><span>Activity Logs</span></a></li>
    </ul>
  </aside>

  <!-- ==================== MAIN CONTENT ==================== -->
  <main class="lg:ml-64 pt-20 px-6 pb-12">

    <!-- Dashboard -->
    <section id="dashboard" class="mb-12">
      <!-- Context Bar -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 flex justify-between items-center">
        <div>
          <h2 class="text-xl font-bold text-blue-900">
            <span id="dash-company">Select a company</span> • 
            <span id="dash-job" class="text-blue-700">Select a job</span>
          </h2>
          <p class="text-sm text-blue-600 mt-1">Admin Dashboard - Multi-tenant overview</p>
        </div>
        <button id="change-context" class="text-blue-700 hover:underline text-sm flex items-center space-x-1">
          <i class="fas fa-sync"></i><span>Change</span>
        </button>
      </div>
    
      <!-- KPI Cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-white p-5 rounded-lg shadow-sm border text-center">
          <p class="text-sm text-gray-500">Total Companies</p>
          <p id="kpi-companies" class="text-3xl font-bold text-gray-900">0</p>
        </div>
        <div class="bg-white p-5 rounded-lg shadow-sm border text-center">
          <p class="text-sm text-gray-500">CVs in Pipeline</p>
          <p id="kpi-cvs" class="text-3xl font-bold text-gray-900">0</p>
        </div>
        <div class="bg-white p-5 rounded-lg shadow-sm border text-center">
          <p class="text-sm text-gray-500">Active Jobs</p>
          <p id="kpi-jobs" class="text-3xl font-bold text-blue-700">0</p>
        </div>
        <div class="bg-white p-5 rounded-lg shadow-sm border text-center">
          <p class="text-sm text-gray-500">Total Users</p>
          <p id="kpi-users" class="text-3xl font-bold text-purple-700">0</p>
        </div>
      </div>
    
      <!-- Top Candidates -->
      <div class="bg-white rounded-lg shadow-sm border p-6 mb-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold">Top 5 Candidates</h3>
          <button class="tab-link text-blue-600 hover:underline text-sm" data-tab="search">View All →</button>
        </div>
        <div id="top-candidates" class="space-y-3">
          <p class="text-sm text-gray-500 italic">Select a company and job to see rankings</p>
        </div>
      </div>
    
      <!-- Activity & Alerts -->
      <div class="bg-white rounded-lg shadow-sm border p-6">
        <h3 class="text-lg font-semibold mb-4">Recent Activity & Alerts</h3>
        <div id="activity-log" class="text-sm text-gray-600 space-y-2 max-h-48 overflow-y-auto">
          <p class="italic">No activity yet. Upload a CV or JD to begin.</p>
        </div>
      </div>
    </section>

    <!-- Upload CV -->
    <section id="upload-cv" class="hidden max-w-4xl mx-auto">
      <h2 class="text-3xl font-bold mb-8 text-center">Upload Candidate CV</h2>
      <form id="cv-form" enctype="multipart/form-data" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700">Company Name *</label>
            <input type="text" name="company_name" required class="mt-1 block w-full border rounded-md px-3 py-2" placeholder="e.g., Google" list="company-list" />
            <datalist id="company-list"></datalist>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Job Title *</label>
            <input type="text" name="job_title" required class="mt-1 block w-full border rounded-md px-3 py-2" placeholder="e.g., Senior ML Engineer" />
          </div>
        </div>

        <div id="cv-dropzone" class="bg-white p-10 rounded-xl shadow-lg border-2 border-dashed border-gray-300 text-center cursor-pointer">
          <i class="fas fa-cloud-upload-alt text-6xl text-blue-600 mb-4"></i>
          <p class="text-xl font-medium text-gray-700 mb-2">Drop CVs here</p>
          <p class="text-sm text-gray-500">or <span class="text-blue-600 underline">click to browse</span></p>
          <p class="text-xs text-gray-400 mt-2">You can select multiple files at once</p>
          <input type="file" name="files" multiple accept=".pdf,.docx,.png,.jpg,.jpeg" class="hidden" />
        </div>

        <div id="cv-file-info" class="hidden bg-gray-50 p-4 rounded-lg">
          <div class="flex justify-between items-center mb-2">
            <span class="font-medium text-sm">Selected Files (<span id="cv-file-count">0</span>)</span>
            <button type="button" id="cv-clear-files" class="text-red-600 hover:underline text-sm">Clear All</button>
          </div>
          <div id="cv-file-list" class="space-y-1 max-h-40 overflow-y-auto"></div>
        </div>

        <div class="flex justify-center space-x-4">
          <button type="submit" class="bg-blue-700 text-white px-8 py-3 rounded-lg hover:bg-blue-800 flex items-center space-x-2">
            <span id="cv-submit-text">Parse & Save CVs</span>
            <div id="cv-spinner" class="hidden spinner ml-2"></div>
          </button>
          <button type="button" class="tab-link bg-gray-300 px-8 py-3 rounded-lg" data-tab="dashboard">Cancel</button>
        </div>
        <div id="cv-upload-progress" class="hidden mt-4">
          <div class="bg-gray-200 rounded-full h-4 overflow-hidden">
            <div id="cv-progress-bar" class="bg-blue-600 h-full transition-all duration-300" style="width: 0%"></div>
          </div>
          <p id="cv-progress-text" class="text-sm text-gray-600 text-center mt-2">Uploading 0 of 0 files...</p>
        </div>
      </form>
    </section>

    <!-- Upload JD -->
    <section id="upload-jd" class="hidden max-w-4xl mx-auto">
      <h2 class="text-3xl font-bold mb-8 text-center">Upload Job Description</h2>
      <form id="jd-form" enctype="multipart/form-data" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700">Company Name *</label>
            <input type="text" name="company_name" required class="mt-1 block w-full border rounded-md px-3 py-2" list="jd-company-list" />
            <datalist id="jd-company-list"></datalist>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Job Title *</label>
            <input type="text" name="job_title" required class="mt-1 block w-full border rounded-md px-3 py-2" />
          </div>
        </div>

        <div id="jd-dropzone" class="bg-white p-10 rounded-xl shadow-lg border-2 border-dashed border-gray-300 text-center cursor-pointer">
          <i class="fas fa-file-alt text-6xl text-green-600 mb-4"></i>
          <p class="text-xl font-medium text-gray-700 mb-2">Drop JD here</p>
          <p class="text-sm text-gray-500">or <span class="text-blue-600 underline">click to browse</span></p>
          <input type="file" name="file" required accept=".pdf,.docx,.txt" class="hidden" />
        </div>

        <!-- Selected file display -->
        <div id="jd-file-info" class="hidden bg-blue-50 p-4 rounded-lg border border-blue-200">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2">
              <i class="fas fa-file-alt text-blue-600"></i>
              <span id="jd-file-name" class="text-gray-700 font-medium"></span>
            </div>
            <button type="button" id="jd-clear-file" class="text-red-600 hover:text-red-800">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>

        <div class="flex justify-center space-x-4">
          <button type="submit" class="bg-green-700 text-white px-8 py-3 rounded-lg hover:bg-green-800 flex items-center space-x-2">
            <span id="jd-submit-text">Save JD</span>
            <div id="jd-spinner" class="hidden spinner ml-2"></div>
          </button>
          <button type="button" class="tab-link bg-gray-300 px-8 py-3 rounded-lg" data-tab="dashboard">Cancel</button>
        </div>
      </form>
    </section>

    <!-- Search & Rank -->
    <section id="search" class="hidden">
      <h2 class="text-3xl font-bold mb-8">Search & Rank Candidates</h2>
      <div class="bg-white p-6 rounded-lg shadow-sm border mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">Company</label>
            <select id="search-company" class="mt-1 block w-full border rounded-md px-3 py-2"></select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Job</label>
            <select id="search-job" class="mt-1 block w-full border rounded-md px-3 py-2" disabled></select>
          </div>
          <div class="flex items-end">
            <button id="search-btn" class="bg-blue-700 text-white px-6 py-2 rounded-lg hover:bg-blue-800 w-full flex items-center justify-center space-x-2">
              <i class="fas fa-search"></i> <span>Search</span>
              <div id="search-spinner" class="hidden spinner ml-2"></div>
            </button>
          </div>
        </div>
      </div>

      <div id="search-results" class="hidden space-y-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold">Ranked Candidates</h3>
          <p class="text-sm text-gray-600">Showing <span id="result-count">0</span> results</p>
        </div>
        <div id="results-list"></div>
      </div>
    </section>

    <!-- User Management -->
    <section id="users" class="hidden max-w-6xl mx-auto">
      <h2 class="text-3xl font-bold mb-8">User Management</h2>
      <div class="grid md:grid-cols-2 gap-8">
        <!-- Create User -->
        <div class="bg-white p-6 rounded-lg shadow-sm border">
          <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
            <i class="fas fa-user-plus text-blue-600"></i> Create New User
          </h3>
          <form id="admin-create-user" class="space-y-3 mb-6">
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-1">Email *</label>
              <input type="email" name="email" required placeholder="user@example.com" class="w-full border rounded px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-1">Password *</label>
              <input type="password" name="password" required minlength="8" placeholder="Minimum 8 characters" class="w-full border rounded px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-1">Companies (comma separated)</label>
              <input type="text" name="companies" placeholder="e.g., Google, Microsoft" class="w-full border rounded px-3 py-2 text-sm" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-1">Role *</label>
              <select name="role" class="w-full border rounded px-3 py-2 text-sm">
                <option value="user">User</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            <button type="submit" class="bg-blue-700 text-white px-4 py-2 rounded text-sm w-full hover:bg-blue-800">
              <i class="fas fa-plus mr-2"></i>Create User
            </button>
            <p id="admin-user-msg" class="text-xs text-gray-500"></p>
          </form>
        </div>

        <!-- Manage Company Access -->
        <div class="bg-white p-6 rounded-lg shadow-sm border">
          <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
            <i class="fas fa-building text-green-600"></i> Company Access
          </h3>
          
          <!-- Assign Company -->
          <form id="assign-company-form" class="space-y-3 mb-6">
            <h4 class="text-sm font-medium text-gray-700">Assign Company to User</h4>
            <input type="email" name="email" required placeholder="User email" class="w-full border rounded px-3 py-2 text-sm" />
            <input type="text" name="company" required placeholder="Company name" class="w-full border rounded px-3 py-2 text-sm" />
            <button type="submit" class="bg-green-700 text-white px-4 py-2 rounded text-sm w-full hover:bg-green-800">
              <i class="fas fa-check mr-2"></i>Assign Company
            </button>
            <p id="assign-msg" class="text-xs text-gray-500"></p>
          </form>

          <!-- Remove Company -->
          <form id="remove-company-form" class="space-y-3 mb-6">
            <h4 class="text-sm font-medium text-gray-700">Remove Company Access</h4>
            <input type="email" name="email" required placeholder="User email" class="w-full border rounded px-3 py-2 text-sm" />
            <input type="text" name="company" required placeholder="Company name" class="w-full border rounded px-3 py-2 text-sm" />
            <button type="submit" class="bg-orange-600 text-white px-4 py-2 rounded text-sm w-full hover:bg-orange-700">
              <i class="fas fa-minus mr-2"></i>Remove Company
            </button>
            <p id="remove-msg" class="text-xs text-gray-500"></p>
          </form>

          <!-- Delete User -->
          <form id="delete-user-form" class="space-y-3">
            <h4 class="text-sm font-medium text-gray-700">Delete User</h4>
            <div class="flex gap-2">
              <input type="email" name="email" required placeholder="User email" class="flex-1 border rounded px-3 py-2 text-sm" />
              <button type="submit" class="bg-red-700 text-white px-4 py-2 rounded text-sm hover:bg-red-800">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            <p id="delete-msg" class="text-xs text-gray-500"></p>
          </form>
        </div>
      </div>

      <!-- Users List -->
      <div class="bg-white p-6 rounded-lg shadow-sm border mt-8">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold">All Users</h3>
          <button id="refresh-users" class="text-sm text-blue-600 hover:underline">
            <i class="fas fa-sync mr-1"></i>Refresh
          </button>
        </div>
        <div id="users-list" class="space-y-2 max-h-96 overflow-auto"></div>
      </div>
    </section>

    <!-- Data Browser -->
    <section id="data-browser" class="hidden max-w-6xl mx-auto">
      <h2 class="text-3xl font-bold mb-8">Company & Job Data Browser</h2>
      
      <!-- Company Overview -->
      <div class="bg-white p-6 rounded-lg shadow-sm border mb-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold">All Companies</h3>
          <button id="refresh-browser" class="text-sm text-blue-600 hover:underline">
            <i class="fas fa-sync mr-1"></i>Refresh
          </button>
        </div>
        <div id="company-browser" class="space-y-4">
          <p class="text-sm text-gray-500 italic">Loading...</p>
        </div>
      </div>

      <!-- Statistics -->
      <div class="grid md:grid-cols-3 gap-4">
        <div class="bg-blue-50 p-5 rounded-lg border border-blue-200">
          <p class="text-sm text-blue-700 mb-1">Total Companies</p>
          <p id="browser-total-companies" class="text-3xl font-bold text-blue-900">0</p>
        </div>
        <div class="bg-green-50 p-5 rounded-lg border border-green-200">
          <p class="text-sm text-green-700 mb-1">Total Jobs</p>
          <p id="browser-total-jobs" class="text-3xl font-bold text-green-900">0</p>
        </div>
        <div class="bg-purple-50 p-5 rounded-lg border border-purple-200">
          <p class="text-sm text-purple-700 mb-1">Total CVs</p>
          <p id="browser-total-cvs" class="text-3xl font-bold text-purple-900">0</p>
        </div>
      </div>
    </section>

    <!-- Bulk Operations -->
    <section id="bulk-ops" class="hidden max-w-4xl mx-auto">
      <h2 class="text-3xl font-bold mb-8">Bulk Delete Operations</h2>
      
      <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6">
        <div class="flex items-center">
          <i class="fas fa-exclamation-triangle text-yellow-600 mr-3"></i>
          <p class="text-sm text-yellow-800">
            <strong>Warning:</strong> Bulk delete operations cannot be undone. Please verify your selections carefully.
          </p>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Delete CVs -->
        <div class="bg-white p-6 rounded-lg shadow-sm border">
          <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
            <i class="fas fa-user-times text-red-600"></i> Delete CVs
          </h3>
          <form id="bulk-delete-cvs" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Company *</label>
              <select name="company" required class="w-full border rounded px-3 py-2 text-sm">
                <option value="">Select Company</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Job Title *</label>
              <select name="job" required class="w-full border rounded px-3 py-2 text-sm">
                <option value="">Select Job</option>
              </select>
            </div>
            <div class="flex items-center space-x-2">
              <input type="checkbox" id="confirm-delete-cvs" required class="rounded">
              <label for="confirm-delete-cvs" class="text-xs text-gray-600">I confirm this action</label>
            </div>
            <button type="submit" class="bg-red-700 text-white px-4 py-2 rounded text-sm w-full hover:bg-red-800">
              <i class="fas fa-trash mr-2"></i>Delete All CVs for This Job
            </button>
            <p id="bulk-cv-msg" class="text-xs text-gray-500"></p>
          </form>
        </div>

        <!-- Delete JDs -->
        <div class="bg-white p-6 rounded-lg shadow-sm border">
          <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
            <i class="fas fa-file-excel text-orange-600"></i> Delete JDs
          </h3>
          <form id="bulk-delete-jds" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Company *</label>
              <select name="company" required class="w-full border rounded px-3 py-2 text-sm">
                <option value="">Select Company</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Job Title (Optional)</label>
              <select name="job" class="w-full border rounded px-3 py-2 text-sm">
                <option value="">All Jobs</option>
              </select>
              <p class="text-xs text-gray-500 mt-1">Leave empty to delete all JDs for company</p>
            </div>
            <div class="flex items-center space-x-2">
              <input type="checkbox" id="confirm-delete-jds" required class="rounded">
              <label for="confirm-delete-jds" class="text-xs text-gray-600">I confirm this action</label>
            </div>
            <button type="submit" class="bg-orange-700 text-white px-4 py-2 rounded text-sm w-full hover:bg-orange-800">
              <i class="fas fa-trash mr-2"></i>Delete Selected JDs
            </button>
            <p id="bulk-jd-msg" class="text-xs text-gray-500"></p>
          </form>
        </div>
      </div>

      <!-- Delete Entire Company -->
      <div class="bg-white p-6 rounded-lg shadow-sm border mt-6">
        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <i class="fas fa-building text-red-700"></i> Delete Entire Company Database
        </h3>
        <div class="bg-red-50 border border-red-200 p-3 rounded mb-4">
          <p class="text-xs text-red-700">
            <i class="fas fa-skull-crossbones mr-2"></i>
            This will permanently delete ALL CVs, JDs, and embeddings for the selected company. This action is irreversible.
          </p>
        </div>
        <form id="delete-company-form" class="space-y-4">
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Company *</label>
              <select name="company" required class="w-full border rounded px-3 py-2 text-sm">
                <option value="">Select Company</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Type company name to confirm *</label>
              <input type="text" name="confirm_name" required placeholder="Type exact company name" class="w-full border rounded px-3 py-2 text-sm" />
            </div>
          </div>
          <button type="submit" class="bg-red-800 text-white px-6 py-2 rounded text-sm hover:bg-red-900">
            <i class="fas fa-exclamation-triangle mr-2"></i>Delete Company Database
          </button>
          <p id="delete-company-msg" class="text-xs text-gray-500"></p>
        </form>
      </div>
    </section>

    <!-- Maintenance -->
    <section id="maintenance" class="hidden max-w-4xl mx-auto">
      <h2 class="text-3xl font-bold mb-8">System Maintenance</h2>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Reindex Embeddings -->
        <div class="bg-white p-6 rounded-lg shadow-sm border">
          <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
            <i class="fas fa-sync-alt text-blue-600"></i> Reindex Embeddings
          </h3>
          <p class="text-sm text-gray-600 mb-4">
            Rebuild vector embeddings for a company. Use this if you've updated the embedding model or suspect corrupted vectors.
          </p>
          <form id="reindex-form" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Company *</label>
              <select name="company" required class="w-full border rounded px-3 py-2 text-sm">
                <option value="">Select Company</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">What to Reindex *</label>
              <select name="type" required class="w-full border rounded px-3 py-2 text-sm">
                <option value="cvs">CVs Only</option>
                <option value="jds">JDs Only</option>
                <option value="both">Both CVs and JDs</option>
              </select>
            </div>
            <button type="submit" class="bg-blue-700 text-white px-4 py-2 rounded text-sm w-full hover:bg-blue-800">
              <i class="fas fa-cogs mr-2"></i>Start Reindexing
            </button>
            <p id="reindex-msg" class="text-xs text-gray-500"></p>
          </form>
        </div>

        <!-- Database Health Check -->
        <div class="bg-white p-6 rounded-lg shadow-sm border">
          <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
            <i class="fas fa-heartbeat text-green-600"></i> Database Health
          </h3>
          <p class="text-sm text-gray-600 mb-4">
            Check the integrity of your databases and embeddings.
          </p>
          <button id="health-check-btn" class="bg-green-700 text-white px-4 py-2 rounded text-sm w-full hover:bg-green-800 mb-4">
            <i class="fas fa-stethoscope mr-2"></i>Run Health Check
          </button>
          <div id="health-results" class="text-sm space-y-2 max-h-64 overflow-auto">
            <p class="text-gray-500 italic">Click button to run health check</p>
          </div>
        </div>
      </div>

      <!-- Backup & Export -->
      <div class="bg-white p-6 rounded-lg shadow-sm border mt-6">
        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <i class="fas fa-download text-purple-600"></i> Export Data
        </h3>
        <p class="text-sm text-gray-600 mb-4">
          Export company data for backup or migration purposes.
        </p>
        <form id="export-form" class="space-y-4">
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Company *</label>
              <select name="company" required class="w-full border rounded px-3 py-2 text-sm">
                <option value="">Select Company</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Export Format *</label>
              <select name="format" required class="w-full border rounded px-3 py-2 text-sm">
                <option value="json">JSON</option>
                <option value="csv">CSV</option>
              </select>
            </div>
          </div>
          <button type="submit" class="bg-purple-700 text-white px-4 py-2 rounded text-sm hover:bg-purple-800">
            <i class="fas fa-file-export mr-2"></i>Export Company Data
          </button>
          <p id="export-msg" class="text-xs text-gray-500"></p>
        </form>
      </div>
    </section>

    <!-- Activity Logs -->
    <section id="logs" class="hidden max-w-6xl mx-auto">
      <h2 class="text-3xl font-bold mb-8">System Activity Logs</h2>

      <!-- Filters -->
      <div class="bg-white p-4 rounded-lg shadow-sm border mb-6">
        <div class="grid md:grid-cols-4 gap-4">
          <div>
            <label class="block text-xs font-medium text-gray-700 mb-1">Action Type</label>
            <select id="log-filter-type" class="w-full border rounded px-3 py-2 text-sm">
              <option value="">All Actions</option>
              <option value="upload_cv">CV Upload</option>
              <option value="upload_jd">JD Upload</option>
              <option value="search">Search</option>
              <option value="delete">Delete</option>
              <option value="error">Errors</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700 mb-1">Company</label>
            <select id="log-filter-company" class="w-full border rounded px-3 py-2 text-sm">
              <option value="">All Companies</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700 mb-1">Time Range</label>
            <select id="log-filter-time" class="w-full border rounded px-3 py-2 text-sm">
              <option value="1">Last Hour</option>
              <option value="24" selected>Last 24 Hours</option>
              <option value="168">Last 7 Days</option>
              <option value="720">Last 30 Days</option>
            </select>
          </div>
          <div class="flex items-end">
            <button id="apply-log-filters" class="bg-blue-700 text-white px-4 py-2 rounded text-sm w-full hover:bg-blue-800">
              <i class="fas fa-filter mr-2"></i>Filter
            </button>
          </div>
        </div>
      </div>

      <!-- Log Entries -->
      <div class="bg-white p-6 rounded-lg shadow-sm border">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-semibold">Recent Activity</h3>
          <div class="flex space-x-2">
            <button id="refresh-logs" class="text-sm text-blue-600 hover:underline">
              <i class="fas fa-sync mr-1"></i>Refresh
            </button>
            <button id="export-logs" class="text-sm text-green-600 hover:underline">
              <i class="fas fa-download mr-1"></i>Export
            </button>
          </div>
        </div>
        <div id="logs-list" class="space-y-2 max-h-96 overflow-auto">
          <p class="text-sm text-gray-500 italic">Loading logs...</p>
        </div>
      </div>

      <!-- Log Statistics -->
      <div class="grid md:grid-cols-4 gap-4 mt-6">
        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
          <p class="text-xs text-blue-700 mb-1">Total Uploads</p>
          <p id="log-stat-uploads" class="text-2xl font-bold text-blue-900">0</p>
        </div>
        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
          <p class="text-xs text-green-700 mb-1">Total Searches</p>
          <p id="log-stat-searches" class="text-2xl font-bold text-green-900">0</p>
        </div>
        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
          <p class="text-xs text-orange-700 mb-1">Active Users</p>
          <p id="log-stat-users" class="text-2xl font-bold text-orange-900">0</p>
        </div>
        <div class="bg-red-50 p-4 rounded-lg border border-red-200">
          <p class="text-xs text-red-700 mb-1">Errors</p>
          <p id="log-stat-errors" class="text-2xl font-bold text-red-900">0</p>
        </div>
      </div>
    </section>

  </main>

  <!-- Toast Notification -->
  <div id="toast" class="fixed bottom-4 right-4 hidden bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-3">
    <i class="fas fa-check-circle"></i>
    <span id="toast-message"></span>
  </div>

  <!-- CV Details Modal -->
  <div id="cv-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
      <div class="flex justify-between items-center p-6 border-b">
        <h3 class="text-2xl font-bold text-gray-800">CV Details</h3>
        <button id="close-cv-modal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
      </div>
      <div class="p-6 overflow-y-auto flex-1">
        <div id="cv-modal-content" class="space-y-4">
          <div class="text-center text-gray-500">
            <i class="fas fa-spinner fa-spin text-3xl mb-2"></i>
            <p>Loading CV...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin JS -->
  <script src="/static/admin.js" defer></script>
</body>
</html>
